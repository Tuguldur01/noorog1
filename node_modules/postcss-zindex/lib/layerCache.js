'use strict';

<<<<<<< HEAD
var has = require('has');
var uniq = require('uniqs');

function LayerCache (opts) {
    if (!(this instanceof LayerCache)) {
        return new LayerCache(opts);
    }
    this._values = [];
    this._startIndex = opts.startIndex || 1;
}

function ascending (a, b) {
    return a - b;
}

function reduceValues (list, value, index) {
    list[value] = index + this._startIndex;
    return list;
}

LayerCache.prototype._findValue = function (value) {
    if (has(this._values, value)) {
        return this._values[value];
=======
var uniq = require('uniqs');

function LayerCache () {
    if (!(this instanceof LayerCache)) {
        return new LayerCache();
    }
    this._values = [];
}

function sortAscending (a, b) {
    return a - b;
}

function mapValues (value, index) {
    return {
        from: value,
        to: index + 1
    };
}

LayerCache.prototype._findValue = function (value) {
    var length = this._values.length;
    for (var i = 0; i < length; ++i) {
        if (this._values[i].from === value) {
            return this._values[i];
        }
>>>>>>> 5a88520246291938171233a829a6c8d57a25619b
    }
    return false;
};

LayerCache.prototype.optimizeValues = function () {
<<<<<<< HEAD
    this._values = uniq(this._values).sort(ascending).reduce(reduceValues.bind(this), {});
=======
    var values = uniq(this._values)
        .sort(sortAscending)
        .map(mapValues);

    this._values = values;
>>>>>>> 5a88520246291938171233a829a6c8d57a25619b
};

LayerCache.prototype.addValue = function (value) {
    var parsedValue = parseInt(value, 10);
    // pass only valid values
    if (!parsedValue || parsedValue < 0) {
        return;
    }
    this._values.push(parsedValue);
};

LayerCache.prototype.getValue = function (value) {
    var parsedValue = parseInt(value, 10);
<<<<<<< HEAD
    return this._findValue(parsedValue) || value;
=======
    var match = this._findValue(parsedValue);
    return match && match.to || value;
>>>>>>> 5a88520246291938171233a829a6c8d57a25619b
};

module.exports = LayerCache;
